<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I: The Mitochondrial Command Center</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }
        
        body { 
            background-color: #020617; 
            margin: 0; 
            overflow: hidden; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            font-family: 'Inter', sans-serif;
        }
        
        .protein-label { 
            font-size: 10px; 
            line-height: 1.1; 
            font-weight: 800;
            white-space: nowrap; 
            pointer-events: none;
            width: auto;
            min-width: 80px;
        }

        .bracket-container {
            position: absolute;
            bottom: 22%;
            left: 0;
            right: 0;
            height: 36px;
            display: flex;
            pointer-events: none;
            padding: 0 3rem;
        }
        .bracket {
            border: 3px solid #1e293b;
            border-top: none;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 6px;
            font-weight: 900;
            font-size: 13px;
            letter-spacing: 0.05em;
            color: #1e293b;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }

        @keyframes turbine-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-turbine {
            animation: turbine-rotate 3s linear infinite;
        }

        .active-target-highlight {
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
            border-color: #ef4444 !important;
        }
    </style>
</head>
<body>
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [completedTerms, setCompletedTerms] = useState([]);
            const [availableTerms, setAvailableTerms] = useState([]);
            const audioContextRef = useRef(null);
            
            const gameSequence = [
                { text: "electron transport chain", type: "essay" },
                { text: "chemiosmosis", type: "essay" },
                { text: "inner membrane of mitochondria", type: "essay" },
                { text: "NADH dehydrogenase", type: "protein" },
                { text: "succinate dehydrogenase", type: "protein" },
                { text: "coenzyme Q", type: "protein" },
                { text: "cytochrome c reductase", type: "protein" },
                { text: "cytochrome c", type: "protein" },
                { text: "cytochrome c oxidase", type: "protein" },
                { text: "ATP synthase", type: "protein" }
            ];

            const speakStep = (stepNumber) => {
                const messages = {
                    0: "Identify the stages of oxidative phosphorylation?",
                    1: "Identify the second stage of oxidative phosphorylation.",
                    2: "Locate where this process occurs in the cell.",
                    3: "Identify the components of the electron transport chain.",
                    9: "Identify the enzyme involved in chemiosmosis."
                };
                const text = messages[stepNumber];
                if (!text) return;
                
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1;
                window.speechSynthesis.speak(utterance);
            };

            const initAudio = async () => {
                if (!audioContextRef.current) {
                    audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioContextRef.current.state === 'suspended') {
                    await audioContextRef.current.resume();
                }
            };

            const playSound = async (type) => {
                try {
                    await initAudio();
                    const ctx = audioContextRef.current;
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);

                    if (type === 'correct') {
                        osc.frequency.setValueAtTime(600, ctx.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.1);
                        gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    } else {
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(150, ctx.currentTime);
                        gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    }
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                } catch(e) {}
            };

            // Initialization: shuffle terms and play Step 1 audio once
            useEffect(() => {
                const shuffled = [...gameSequence].map(item => item.text).sort(() => Math.random() - 0.5);
                setAvailableTerms(shuffled);

                // Play only Step 1 audio once
                speakStep(0);
            },
